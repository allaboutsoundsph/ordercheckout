<script>

// =======================
// FACEBOOK PIXEL
// =======================
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}
(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');

fbq('init', 'YOUR_PIXEL_ID'); 
fbq('track', 'PageView');
fbq('track', 'ViewContent');


// =======================
// DAILY AUTO RESET COUNTDOWN
// =======================

function startDailyCountdown(){
    const timer = document.getElementById("timer");

    function updateTimer(){
        const now = new Date();
        const midnight = new Date();
        midnight.setHours(24,0,0,0);

        const diff = midnight - now;

        const h = String(Math.floor(diff/1000/60/60)).padStart(2,'0');
        const m = String(Math.floor((diff/1000/60)%60)).padStart(2,'0');
        const s = String(Math.floor((diff/1000)%60)).padStart(2,'0');

        timer.innerText = `${h}:${m}:${s}`;
    }

    updateTimer();
    setInterval(updateTimer,1000);
}
startDailyCountdown();


// =======================
// BUYER COUNTER (DYNAMIC)
// =======================
let buyers = Math.floor(Math.random()*10)+15;
setInterval(()=>{
    buyers += Math.floor(Math.random()*2);
    document.getElementById("buyerCount").innerText = buyers;
},5000);


// =======================
// SLOT RANDOMIZER
// =======================
document.getElementById("slots").innerText = Math.floor(Math.random()*3)+3;


// =======================
// REVIEW CAROUSEL
// =======================
let reviewIndex = 0;

function moveReview(d){
    const track = document.getElementById("reviewTrack");
    const total = track.children.length;
    reviewIndex += d;

    if(reviewIndex < 0) reviewIndex = total-1;
    if(reviewIndex >= total) reviewIndex = 0;

    track.style.transform = `translateX(-${reviewIndex*100}%)`;
}

setInterval(()=>{ moveReview(1); },3000);


// =======================
// ADVANCED PH ADDRESS SYSTEM
// =======================

document.addEventListener("DOMContentLoaded",function(){

const province = document.getElementById("province");
const city = document.getElementById("city");
const barangay = document.getElementById("barangay");
const street = document.getElementById("street");
const address = document.getElementById("address");

// Load provinces
fetch("https://psgc.gitlab.io/api/provinces/")
.then(res => res.json())
.then(data => {
    data.sort((a,b)=>a.name.localeCompare(b.name));
    province.innerHTML='<option value="">Select Province</option>';

    let ncr=document.createElement("option");
    ncr.value="130000000";
    ncr.textContent="Metro Manila (NCR)";
    province.appendChild(ncr);

    data.forEach(p=>{
        let opt=document.createElement("option");
        opt.value=p.code;
        opt.textContent=p.name;
        province.appendChild(opt);
    });
});

// Province change
province.addEventListener("change",function(){
    city.innerHTML="<option>Loading...</option>";
    barangay.innerHTML="<option>Select Barangay</option>";

    let url = this.value==="130000000"
    ?"https://psgc.gitlab.io/api/regions/130000000/cities-municipalities/"
    :`https://psgc.gitlab.io/api/provinces/${this.value}/cities-municipalities/`;

    fetch(url)
    .then(res=>res.json())
    .then(data=>{
        city.innerHTML='<option value="">Select City</option>';
        data.forEach(c=>{
            let opt=document.createElement("option");
            opt.value=c.code;
            opt.textContent=c.name;
            city.appendChild(opt);
        });
    });
});

// City change
city.addEventListener("change",function(){
    barangay.innerHTML="<option>Loading...</option>";

    fetch(`https://psgc.gitlab.io/api/cities-municipalities/${this.value}/barangays/`)
    .then(res=>res.json())
    .then(data=>{
        barangay.innerHTML='<option value="">Select Barangay</option>';
        data.forEach(b=>{
            let opt=document.createElement("option");
            opt.value=b.name;
            opt.textContent=b.name;
            barangay.appendChild(opt);
        });
    });
});

// Auto update address
function updateAddress(){
    address.value = `${street.value}, ${barangay.value}, ${city.options[city.selectedIndex]?.text || ''}, ${province.options[province.selectedIndex]?.text || ''}`;
}

street.addEventListener("input",updateAddress);
barangay.addEventListener("change",updateAddress);


// =======================
// FORM SUBMIT
// =======================

const form = document.getElementById("orderForm");

form.addEventListener("focusin",()=>{
    fbq('track','Lead');
});

form.addEventListener("submit",function(){
    fbq('track','Purchase');

    setTimeout(()=>{
        window.location.href="https://m.me/allaboutsoundsphmain";
    },1000);
});

});

</script>
